{"version":3,"sources":["../../../src/hooks/cross-domain-cookies/index.ts","../../../src/constants/app-cookie/index.ts","../../../src/util/check-is-client/index.ts"],"sourcesContent":["import dayjs from \"dayjs\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport AppCookieConstants from \"../../constants/app-cookie\";\nimport { assertRunningAsClient } from \"../../util/check-is-client\";\n\n// ÎèÑÎ©îÏù∏ÏùÄ taling.meÏóêÏÑú Î≥ÄÌï† ÏòàÏ†ï ÏóÜÏúºÎØÄÎ°ú ÏÉÅÏàò ÏÑ†Ïñ∏Ìï¥ÏÑú ÏÇ¨Ïö©\nconst DOMAIN = \"taling.me\";\n\nexport default function useCrossDomainCookies() {\n  /**\n   * Ïø†ÌÇ§Ï∞æÍ∏∞\n   * @param key Ïø†ÌÇ§ ÌÇ§\n   * @returns\n   */\n  function findCookie(key: string) {\n    assertRunningAsClient();\n    const cookies = document.cookie.split(\"; \");\n    const cookie = cookies.find((cookie) => cookie.startsWith(key));\n    return cookie;\n  }\n\n  const setCrossDomainAuthCookie = (accessToken: string) => {\n    assertRunningAsClient();\n    const key = AppCookieConstants.crossDomainUserAuth;\n    document.cookie = `${key}=${accessToken}; path=/; domain=${DOMAIN};`;\n  };\n\n  const clearCrossDomainAuthCookie = () => {\n    assertRunningAsClient();\n    const key = AppCookieConstants.crossDomainUserAuth;\n    document.cookie = `${key}=; path=/; domain=${DOMAIN}; expires=Thu, 01 Jan 1970 00:00:00 GMT`;\n  };\n\n  const getCrossDomainAuthCookie = () => {\n    assertRunningAsClient();\n    const cookie = findCookie(AppCookieConstants.crossDomainUserAuth);\n    if (!cookie) return null;\n    const [, value] = cookie.split(\"=\");\n    return value;\n  };\n\n  const getOrCreateTalingPixelSessionId = () => {\n    assertRunningAsClient();\n    const expireDate = dayjs().add(30, \"day\").toDate().toUTCString();\n    const key = AppCookieConstants.crossDomainTalingPixelSessionId;\n    const cookie = findCookie(key);\n\n    if (!cookie) {\n      const sessionId = uuidv4();\n      document.cookie = `${key}=${sessionId}; path=/; domain=${DOMAIN}; expires=${expireDate};`;\n      return sessionId;\n    }\n    const [, value] = cookie.split(\"=\");\n    return value;\n  };\n\n  return {\n    /**\n     * ÌÅ¨Î°úÏä§ ÎèÑÎ©îÏù∏ Ïù∏Ï¶ù Ïö© Ïø†ÌÇ§ ÏÑ§Ï†ï\n     * @param accessToken\n     */\n    setCrossDomainAuthCookie,\n\n    /**\n     * ÌÅ¨Î°úÏä§ ÎèÑÎ©îÏù∏ Ïù∏Ï¶ù Ïö© Ïø†ÌÇ§ ÏÇ≠Ï†ú\n     */\n    clearCrossDomainAuthCookie,\n\n    /**\n     * ÌÅ¨Î°úÏä§ ÎèÑÎ©îÏù∏ Ïù∏Ï¶ù Ïö© Ïø†ÌÇ§ Ï°∞Ìöå\n     */\n    getCrossDomainAuthCookie,\n\n    /**\n     * ÌÉàÏûâ ÌîΩÏÖÄÏö© ÏÑ∏ÏÖò Ïø†ÌÇ§ Í∞ÄÏ†∏Ïò§Í∏∞. ÏóÜÎã§Î©¥ ÏÉùÏÑ±Ìï©ÎãàÎã§.\n     * @returns string\n     */\n    getOrCreateTalingPixelSessionId,\n  };\n}\n","const AppCookieConstants = {\n  isApp: \"taling-app\", // true / false\n  appVersion: \"taling-app-version\", // eg. 4.0.40\n\n  appBuildNum: \"taling-app-build-num\", // eg. 436\n\n  // iOS: \"iOS\" on newer iOS devices \"iPhone OS\" on older devices (including older iPad models), \"iPadOS\" for iPads using iPadOS 15.0 or higher.\n  // Android: \"Android\"\n  appPlatform: \"taling-app-platform\",\n\n  appUserAuth: \"taling-app-user-auth\",\n\n  crossDomainUserAuth: \"taling-crossdomain-user-auth\",\n\n  crossDomainTalingPixelSessionId: \"taling-pixel:sessionId\",\n};\n\nexport default AppCookieConstants;\n","export function assertRunningAsClient() {\n  // assert ?\n  if (typeof document === \"undefined\") {\n    throw new Error(\"üõë document is not defined! ÏÑúÎ≤ÑÏÇ¨Ïù¥ÎìúÏóêÏÑú Ìò∏Ï∂ú?\");\n  }\n}\n"],"mappings":";AAAA,OAAO,WAAW;AAClB,SAAS,MAAM,cAAc;;;ACD7B,IAAM,qBAAqB;AAAA,EACzB,OAAO;AAAA;AAAA,EACP,YAAY;AAAA;AAAA,EAEZ,aAAa;AAAA;AAAA;AAAA;AAAA,EAIb,aAAa;AAAA,EAEb,aAAa;AAAA,EAEb,qBAAqB;AAAA,EAErB,iCAAiC;AACnC;AAEA,IAAO,qBAAQ;;;ACjBR,SAAS,wBAAwB;AAEtC,MAAI,OAAO,aAAa,aAAa;AACnC,UAAM,IAAI,MAAM,6FAAyC;AAAA,EAC3D;AACF;;;AFCA,IAAM,SAAS;AAEA,SAAR,wBAAyC;AAM9C,WAAS,WAAW,KAAa;AAC/B,0BAAsB;AACtB,UAAM,UAAU,SAAS,OAAO,MAAM,IAAI;AAC1C,UAAM,SAAS,QAAQ,KAAK,CAACA,YAAWA,QAAO,WAAW,GAAG,CAAC;AAC9D,WAAO;AAAA,EACT;AAEA,QAAM,2BAA2B,CAAC,gBAAwB;AACxD,0BAAsB;AACtB,UAAM,MAAM,mBAAmB;AAC/B,aAAS,SAAS,GAAG,GAAG,IAAI,WAAW,oBAAoB,MAAM;AAAA,EACnE;AAEA,QAAM,6BAA6B,MAAM;AACvC,0BAAsB;AACtB,UAAM,MAAM,mBAAmB;AAC/B,aAAS,SAAS,GAAG,GAAG,qBAAqB,MAAM;AAAA,EACrD;AAEA,QAAM,2BAA2B,MAAM;AACrC,0BAAsB;AACtB,UAAM,SAAS,WAAW,mBAAmB,mBAAmB;AAChE,QAAI,CAAC,OAAQ,QAAO;AACpB,UAAM,CAAC,EAAE,KAAK,IAAI,OAAO,MAAM,GAAG;AAClC,WAAO;AAAA,EACT;AAEA,QAAM,kCAAkC,MAAM;AAC5C,0BAAsB;AACtB,UAAM,aAAa,MAAM,EAAE,IAAI,IAAI,KAAK,EAAE,OAAO,EAAE,YAAY;AAC/D,UAAM,MAAM,mBAAmB;AAC/B,UAAM,SAAS,WAAW,GAAG;AAE7B,QAAI,CAAC,QAAQ;AACX,YAAM,YAAY,OAAO;AACzB,eAAS,SAAS,GAAG,GAAG,IAAI,SAAS,oBAAoB,MAAM,aAAa,UAAU;AACtF,aAAO;AAAA,IACT;AACA,UAAM,CAAC,EAAE,KAAK,IAAI,OAAO,MAAM,GAAG;AAClC,WAAO;AAAA,EACT;AAEA,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA,IAKL;AAAA;AAAA;AAAA;AAAA,IAKA;AAAA;AAAA;AAAA;AAAA,IAKA;AAAA;AAAA;AAAA;AAAA;AAAA,IAMA;AAAA,EACF;AACF;","names":["cookie"]}